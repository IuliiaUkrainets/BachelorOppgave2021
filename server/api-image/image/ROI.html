<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <style>
        div.focus-image {
  border:1px solid #dddddd;
  display:inline-block;
  position:relative;
  cursor:pointer;
}
div.focus-image div {
  display:none;
  border:2px solid red;
  position:absolute;
  left:90px; /*x*/
  top:60px; /*y*/
}
img{
width: 512px;
height:512px;
}
    </style>
</head>
<body>
    <div id="cont" class="focus-image">
      
        <img id="image" src="http://localhost:5000/getImage/0004.jpg" />
        <div id="bbox"></div>
      </div>
      <script>
  fetch("http://127.0.0.1:5000/images/['0004']").then(x=> x.json()).then(x=>
 {
        document.getElementById('image').src = x['0004'];
    });
        var x,y,oldx,oldy;
var showDrag = false;
document.getElementById("cont").addEventListener("mousedown", function(e) {
  oldx = e.clientX; //mousedown x coord
  oldy = e.clientY; //mouedown y coord
  // console.log(oldx, oldy);
  showDrag = true;
  e.preventDefault();
});
let x_coord = 0;
let y_coord = 0;

document.getElementById("cont").addEventListener("mousemove", function(e) {
  if (showDrag == true) {
    x = e.clientX; //det første mouseup x coord
    y = e.clientY; //det andre mouseup y coord
    x_coord = x;
    y_coord = y;
    var bbox = document.getElementById("bbox");
    var contbox = document.getElementById("cont");
    //få bredden og høyden på det slepte området
    var w = (x > oldx ? x-oldx : oldx-x);
    var h = (y > oldy ? y-oldy : oldy-y);
    var addx = 0, addy = 0;
    //disse to neste linjene bedømmer om boksen ble dratt bakover
    //og legger boksens bredde til bbox-posisjoneringsforskyvningen
    if (x < oldx) { addx = w; }
    if (y < oldy) { addy = h; }
    bbox.style.left = (oldx-parseInt((contbox.offsetLeft+addx)))+"px";
    bbox.style.top = (oldy-parseInt((contbox.offsetTop+addy)))+"px";
    bbox.style.width = w+"px";
    bbox.style.height = h+"px";
    bbox.style.display = "block";
  }
  e.preventDefault();
});
document.getElementById("cont").addEventListener("mouseup", function(e) {
  showDrag = false;
  fetch('http://127.0.0.1:5030/roi/0004,'+oldx+','+oldy+','+x_coord+','+y_coord+'').then(x=> x.json()).then(x=>
    {
      document.querySelector('img').src = 'http://localhost:5000/getImage/' + x.image;
      var bbox = document.getElementById("bbox");
      bbox.style = '';
    })
  console.log(oldx, oldy, x_coord, y_coord);
  e.preventDefault();
});
    </script>
</body>
</html>
